<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Opening Melodo...</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #0E0D09; /* Melodo Background */
            color: #F0E6D6; /* Melodo Text Primary */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            text-align: center;
            padding: 20px;
        }
        .loader {
            border: 5px solid #1E1B17; /* Melodo Elevated */
            border-top: 5px solid #D4A85A; /* Melodo Primary */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        p { color: #9D9283; /* Melodo Text Secondary */ }
        a { color: #D4A85A; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .store-links { margin-top: 30px; }
        .store-links img { height: 45px; margin: 0 10px; }
    </style>
</head>
<body>
    <div class="loader"></div>
    <h1>Taking you to Melodo...</h1>
    <p>If the app doesn't open automatically, please use the links below.</p>
    <div class="store-links">
        <a id="appStoreLink" href="#"><img src="https://linkmaker.itunes.apple.com/images/badges/en-us/badge_appstore-lrg.svg" alt="Download on the App Store"></a>
        <a id="playStoreLink" href="#"><img src="https://play.google.com/intl/en_us/badges/static/images/badges/en_badge_web_generic.png" alt="Get it on Google Play"></a>
    </div>
    <p style="margin-top: 30px;"><a href="/">Go to Melodo Homepage</a></p>

    <script>
        (function() {
            const path = window.location.pathname; // e.g., /u/userId, /r/reviewId
            const parts = path.split('/').filter(Boolean); // e.g., ['u', 'userId']

            let appPath = '';
            let type = '';
            let id = '';

            if (parts.length === 2) {
                type = parts[0]; // 'u', 'r', 'c', 'v'
                id = parts[1];

                // Map web paths to app's internal deep link paths if they differ
                // Assuming they are the same structure for now:
                // melodo://user/xxxx, melodo://review/xxxx, etc.
                switch(type) {
                    case 'u': appPath = `user/${id}`; break;
                    case 'r': appPath = `review/${id}`; break;
                    case 'c': appPath = `collection/${id}`; break;
                    case 'v': appPath = `vinyl/${id}`; break; // Or `user/${id}/vinyl` if that's the structure
                    default:
                        // Unknown path type, redirect to homepage
                        window.location.replace('/');
                        return;
                }
            } else {
                // Path doesn't match expected deep link structure, redirect to homepage
                window.location.replace('/');
                return;
            }

            const appURL = `melodo://${appPath}`; // Your app's URL scheme

            const appStoreID = '6744846435'; 
            const playStoreID = 'com.yourdomain.Melodo'; // IMPORTANT: Replace!

            const appStoreURL = `https://apps.apple.com/app/id${appStoreID}`;
            const playStoreURL = `https://play.google.com/store/apps/details?id=${playStoreID}`;

            // Update store links on the page
            document.getElementById('appStoreLink').href = appStoreURL;
            document.getElementById('playStoreLink').href = playStoreURL;
            
            // Attempt to open the app
            window.location.replace(appURL);

            // Fallback to App Store or Play Store
            const timeout = setTimeout(() => {
                if (document.hidden || document.webkitHidden) { // Heuristic: if page is hidden, app likely opened
                    clearTimeout(timeout);
                    return;
                }
                // If app didn't open, redirect to the appropriate store
                if (navigator.userAgent.toLowerCase().indexOf("iphone") > -1 || navigator.userAgent.toLowerCase().indexOf("ipad") > -1) {
                    window.location.replace(appStoreURL);
                } else if (navigator.userAgent.toLowerCase().indexOf("android") > -1) {
                    window.location.replace(playStoreURL);
                } else {
                    // For desktop, the page with store links will remain visible.
                    console.log("Desktop or unknown OS. Store links are available on the page.");
                }
            }, 2500); // Increased timeout for better reliability
        })();
    </script>
</body>
</html>
